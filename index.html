<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Webcam for PC</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #00bcd4, #3f51b5);  /* Blue and Cyan Gradient */
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      text-align: center;
      flex-direction: column;
      margin: 0;
    }

    h1 {
      font-size: 3em;
      margin-bottom: 20px;
      color: #ffffff;
      text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.4);
    }

    video {
      max-width: 100%;
      max-height: 75vh;
      border: 4px solid #3f51b5;
      border-radius: 10px;
      margin-bottom: 20px;
      background-color: #000;
      box-shadow: 0px 4px 20px rgba(0, 0, 0, 0.6);
    }

    .disclaimer {
      font-size: 1.2em;
      margin-top: 20px;
      color: #ffeb3b;  /* Yellow for visibility */
      background-color: #1e3d66;
      padding: 15px;
      border-radius: 8px;
      max-width: 90%;
      margin: 10px auto;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
    }

    .disclaimer p {
      margin: 0;
      line-height: 1.4;
    }

    button {
      padding: 12px 25px;
      font-size: 1.1em;
      margin: 10px;
      cursor: pointer;
      border: none;
      border-radius: 5px;
      transition: background-color 0.3s ease, transform 0.2s ease-in-out;
      color: #fff;
      background-color: #00bcd4;  /* Cyan */
    }

    button:hover {
      background-color: #008c9e;  /* Darker Cyan */
      transform: scale(1.05);
    }

    button.recording {
      background-color: #ff4081;  /* Pinkish color for recording */
    }

    .controls {
      margin-top: 20px;
    }

    select, input {
      font-size: 1em;
      padding: 8px 16px;
      margin: 10px;
      cursor: pointer;
      background-color: #3f51b5;  /* Blue */
      color: white;
      border: none;
      border-radius: 5px;
      transition: background-color 0.3s ease;
    }

    select:focus, input:focus {
      outline: none;
      background-color: #00bcd4;  /* Cyan when focused */
    }

    input::placeholder {
      color: #ddd;
    }

    a {
      display: none;
      margin-top: 10px;
      padding: 10px 20px;
      background-color: #00bcd4;  /* Cyan */
      color: white;
      text-decoration: none;
      border-radius: 5px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
    }

    a:hover {
      background-color: #008c9e;  /* Darker Cyan */
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 2.5em;
      }

      video {
        max-height: 60vh;
      }

      button {
        font-size: 1em;
        padding: 10px 20px;
      }
    }
  </style>
</head>
<body>

  <h1>Webcam for PC</h1>

  <!-- Disclaimer about the tool's function -->
  <div class="disclaimer">
    <p><strong>Disclaimer:</strong> This tool only records your webcam footage in its original format (WebM) and offers an option to convert it to MP4. No edits or modifications are made to your footage. The video is saved as it was recorded.</p>
  </div>

  <video id="webcam" autoplay playsinline muted></video>

  <div class="controls">
    <button onclick="toggleFullscreen()">Toggle Fullscreen</button>

    <!-- Format Selection Dropdown -->
    <select id="formatSelect">
      <option value="webm">WebM</option>
      <option value="mp4">MP4 (Conversion Required)</option>
    </select>

    <!-- Custom Filename Input -->
    <input type="text" id="filenameInput" placeholder="Enter filename" />

    <button id="recordBtn" onclick="toggleRecording()">Start Recording</button>
    <a id="downloadLink" style="display:none;">Download Recording</a>
  </div>

  <!-- Include ffmpeg.js -->
  <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@4.4.2/dist/ffmpeg.min.js"></script>

  <script>
    const video = document.getElementById('webcam');
    const recordBtn = document.getElementById('recordBtn');
    const downloadLink = document.getElementById('downloadLink');
    const formatSelect = document.getElementById('formatSelect');
    const filenameInput = document.getElementById('filenameInput');

    let mediaRecorder;
    let recordedChunks = [];
    let isRecording = false;
    let fileExtension = 'webm';
    let fileName = 'recorded-webcam';

    // Request access to webcam
    async function initWebcam() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        video.srcObject = stream;

        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.ondataavailable = function (e) {
          if (e.data.size > 0) recordedChunks.push(e.data);
        };

        mediaRecorder.onstop = function () {
          const selectedFormat = formatSelect.value;
          const timestamp = new Date().toISOString().replace(/[:.]/g, '-');  // Format timestamp for filename
          fileExtension = selectedFormat === 'mp4' ? 'mp4' : 'webm';
          
          // Use custom filename or default
          fileName = filenameInput.value.trim() || `recorded-webcam-${timestamp}`;
          
          // Generate the blob and URL for WebM or MP4 download
          const blob = new Blob(recordedChunks, { type: selectedFormat === 'webm' ? 'video/webm' : 'video/mp4' });
          recordedChunks = [];
          const url = URL.createObjectURL(blob);
          
          downloadLink.href = url;
          downloadLink.download = `${fileName}.${fileExtension}`;  // Dynamic filename
          downloadLink.style.display = 'inline-block';

          // MP4 conversion
          if (selectedFormat === 'mp4') {
            convertToMp4(blob);
          }
        };
      } catch (err) {
        alert('Error accessing webcam: ' + err);
      }
    }

    // Convert WebM to MP4 using ffmpeg.js
    async function convertToMp4(blob) {
      const { createFFmpeg, fetchFile } = FFmpeg;
      const ffmpeg = createFFmpeg({ log: true });

      await ffmpeg.load();
      const webmFile = new Blob([blob], { type: 'video/webm' });

      // Convert WebM file to MP4
      ffmpeg.FS('writeFile', 'input.webm', await fetchFile(webmFile));
      await ffmpeg.run('-i', 'input.webm', 'output.mp4');

      // Get the converted MP4 file from the FS
      const mp4Data = ffmpeg.FS('readFile', 'output.mp4');

      // Create a download link for MP4
      const mp4Blob = new Blob([mp4Data.buffer], { type: 'video/mp4' });
      const url = URL.createObjectURL(mp4Blob);

      downloadLink.href = url;
      downloadLink.download = `${fileName}.mp4`;  // Set MP4 filename
    }

    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        video.requestFullscreen().catch(err => {
          alert(`Error attempting to enable fullscreen mode: ${err.message}`);
        });
      } else {
        document.exitFullscreen();
      }
    }

    function toggleRecording() {
      if (!mediaRecorder) return;

      if (isRecording) {
        mediaRecorder.stop();
        recordBtn.textContent = 'Start Recording';
        recordBtn.classList.remove('recording');
        isRecording = false;
      } else {
        recordedChunks = [];
        mediaRecorder.start();
        recordBtn.textContent = 'Stop Recording';
        recordBtn.classList.add('recording');
        downloadLink.style.display = 'none';
        isRecording = true;
      }
    }

    // Start webcam on load
    window.onload = initWebcam;
  </script>

</body>
</html>
